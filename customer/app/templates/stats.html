{% extends "layout.html" %}
{% block content %}
{% include "navbar.html" %}
{% include "_flashing.html" -%}

<div class="container max-w-4xl mx-auto" x-data="{open: 1}">

    <p class="md:max-w-md md:mx-auto mx-2 mt-8 text-xl font-bold text-gray-500">受注データ</p>

    <!-- date or dates range select and display summary -->
    <div class="md:max-w-md md:mx-auto mx-2 mt-5 p-5 border rounded-lg shadow-lg">
        <ul class="flex cursor-pointer text-center text-gray-500">
            <li class="w-1/2 py-3" x-on:click="open = 1" :class="{'text-blue-700 border-b-2 border-blue-600': open === 1}">日付</li>
            <!-- <li class="w-1/2 py-3" x-on:click="open = 2" :class="{'text-blue-700 border-b-2 border-blue-600': open === 2}">範囲</li> -->
        </ul>
    
        <!-- date target == 1 -->
        <div class="mt-8" x-show="open === 1">
            <div class="mt-7">
                <form action="/stats" method="GET">
                    <input class="block border-b w-1/2" type="date" min="2022-03-01" name="target" required>
                    <button type="submit" class="block w-full bg-blue-500 text-sm hover:bg-blue-800 text-white mt-8 py-1 px-5 rounded-full shadow-xl">
                        検索
                    </button>
                </form>
            </div>

            <div class="mt-10">
                <p class="text-2xl">{{ target }}</p>
            </div>  
        </div>
        <!-- date target == 1 -->
    
        <!-- date range == 2-->
        <div class="mt-8" x-show="open === 2">
            <div class="mt-7">
                <form action="/order/range" method="GET">
                    <label for="date_from" class="hidden">から</label>
                    <input class="border-b" type="date" min="2022-03-01" name="date_from" id="date_from" required>
                    <label for="date_to" class="px-3">〜</label>
                    <input class="border-b" type="date" min="2020-09-01" name="date_to" id="date_to" required>
                    <button type="submit" class="block w-full bg-blue-500 hover:bg-blue-800 text-sm text-white mt-8 py-1 px-5 rounded-full shadow-xl">
                        検索
                    </button>
                </form>
            </div>

            <div class="mt-10">
                <div class="px-3 text-2xl text-center">{{ date_from or '' }} <span class="text-gray-300">〜</span> {{ date_to or '' }}</div>
            </div>  
        </div>
        <!-- date range == 2-->
    </div>

    <!-- date result == 1 table -->
    <div class="md:max-w-md md:mx-auto my-5 mx-2" x-show="open === 1">
        <!-- <div class="flex mt-7 mb-3 text-blue-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            <a href="/order/data?dl=csv&target={{ target }}" class="hover:underline mx-3 ">
                csvダウンロード
            </a>
        </div> -->
    
        <table class="table-auto w-full text-sm">
            <thead>
                <tr class="border-b border-black">
                    <th clss="py-2">番号</th>
                    <th class="py-2">受注日</th>
                    <th class="py-2">事業所</th>
                    <th class="py-2">商品</th>
                    <th class="py-2">単価</th>
                    <th class="py-2">数量</th>
                </tr>
            </thead>
            {% for order in orders %}
            <tbody>
                <tr class="border-b">
                    <td>{{ '{:06d}'.format(order.id) }}</td>
                    <td>{{ order.date.strftime('%m-%d') }}</td>
                    <td>{{ order.customer_id }}-{{ order.shop_id }} {{ order.shop.name }}</td>
                    <td>{{ order.product.abbre }}</td>
                    <td class="text-right">{{ '{:,d}'.format(order.price) }}</td>
                    <td class="text-right">{{ order.qty }}</td>
                </tr>
            </tbody> 
            {% endfor %}
        </table>
    </div>

</div>

<!-- alpine.js -->
<script>
    const getToday = () => {
        let now = new Date();
        let year = now.getFullYear();
        let month = now.getMonth() + 1;
        let date = now.getDate();
        let hours = now.getHours().toString().padStart(2, '0');
        let minutes = now.getMinutes().toString().padStart(2, '0');
        return {
            today: year + "年" + month + "月" + date + "日" + "　" + hours + ":" + minutes
        }
    }
</script>

{% endblock %}

{% extends "layout.html" %}
{% block content %}
{% include "navbar.html" %}
<div class="container max-w-4xl mx-auto mt-5">
    <div class="mt-3 mx-auto">
        <p class="font-bold text-lg">受注データ</p>

        <div class="my-5">
            <a href="/order/range" class="text-blue-500 hover:underline">日付範囲へ</a>
        </div>

        <div class="flex items-center mt-7">
            <form action="/order/data" method="GET">
                <label for="target" class="text-sm">受注登録日</label>
                <input class="border ml-5" type="date" min="2020-09-01" name="target" id="date_selected" required>
                <button type="submit" class="bg-blue-500 hover:bg-blue-800 text-sm text-white mx-7 py-1 px-7 rounded-full shadow-xl">
                    検索</button>
            </form>
        </div>
        
        <div class="my-5">
            <p class="text-sm">受注日 <span class="text-xl">{{ target }}</span></p>
            <table class="table-auto w-full mt-3">
                <thead>
                <tr class="border-black border-b">
                    <th class="py-2 text-center">箱数</th>
                    <th class="py-2 text-center">商品売上</th>
                    <th class="py-2 text-center">送料売上</th>
                    <th class="py-2 text-center">売上合計</th>
                </tr>
                </thead>
                
                <tbody>
                <tr>
                    <td class="text-center">{{ sum_qty or 0 }}</td>
                    <td class="text-center">{{ '{:,}'.format(sum_price) if sum_price else 0 }}</td>
                    <td class="text-center">{{ '{:,}'.format(sum_delivery_price) if sum_delivery_price else 0 }}</td>
                    <td class="text-center">{{ '{:,}'.format(total_price) if total_price else 0 }}</td>
                </tr>
                </tbody>

            </table>
            <div class="flex mt-7 mb-3 text-blue-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                    <a href="/order/data?dl=csv&target={{ target }}" class="hover:underline">
                    <p class="ml-3">csvダウンロード</p>
                    </a>
                </div>

            <table class="table-auto w-full text-sm">
                <thead>
                <tr class="border-b border-black">
                    <th class="py-2">番号</th>
                    <th class="py-2">受注日</th>
                    <th class="py-2">担当</th>
                    <th class="py-2">事業所</th>
                    <th class="py-2">住所</th>
                    <th class="py-2">商品</th>
                    <th class="py-2">単価</th>
                    <th class="py-2">数量</th>
                </tr>
                </thead>
                {% for order in orders %}
                <tr class="border-b">
                    <td>{{ '{:06d}'.format(order.id) }}</td>
                    <td>{{ order.date.strftime('%m-%d %H:%M') }}</td>
                    <td>{{ order.staff.last_name }}</td>
                    <td>{{ order.customer_id }}-{{ order.shop_id }} {{ order.shop.name }}</td>
                    <td>{{ order.shop.prefecture }}</td>
                    <td>{{ order.product.name }}</td>
                    <td class="text-right">{{ '{:,d}'.format(order.price) }}</td>
                    <td class="text-right">{{ order.qty }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
{% endblock %}
